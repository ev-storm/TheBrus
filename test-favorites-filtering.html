<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–¢–µ—Å—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
        background: #1a1a1a;
        color: white;
      }
      .test-section {
        background: #2a2a2a;
        padding: 20px;
        margin: 20px 0;
        border-radius: 8px;
      }
      .status {
        padding: 10px;
        margin: 10px 0;
        border-radius: 4px;
      }
      .success {
        background: #4caf50;
      }
      .error {
        background: #f44336;
      }
      .info {
        background: #2196f3;
      }
      .test-button {
        background: #65c36c;
        color: white;
        border: none;
        padding: 10px 20px;
        margin: 5px;
        border-radius: 4px;
        cursor: pointer;
      }
      .test-button:hover {
        background: #5ab060;
      }
      .favorites-list {
        background: #333;
        padding: 15px;
        border-radius: 4px;
        margin: 10px 0;
      }
      .card {
        background: #444;
        padding: 15px;
        margin: 10px 0;
        border-radius: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border: 2px solid transparent;
        transition: all 0.3s ease;
      }
      .card.favorite {
        border-color: #65c36c;
        background: #3a4a3a;
      }
      .card.filtered-out {
        display: none;
      }
      .like-button {
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        font-size: 20px;
        transition: all 0.3s ease;
      }
      .like-button.liked {
        color: #65c36c;
        transform: scale(1.2);
      }
      .like-button:hover {
        color: #65c36c;
      }
      .filter-toggle {
        background: #ff9800;
        color: white;
        border: none;
        padding: 10px 20px;
        margin: 5px;
        border-radius: 4px;
        cursor: pointer;
      }
      .filter-toggle.active {
        background: #65c36c;
      }
      .test-results {
        background: #333;
        padding: 15px;
        border-radius: 4px;
        margin: 10px 0;
        font-family: monospace;
        white-space: pre-wrap;
      }
    </style>
  </head>
  <body>
    <h1>üîç –¢–µ—Å—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ</h1>

    <div class="test-section">
      <h2>üìä –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</h2>
      <div id="status" class="status info">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>
      <div class="favorites-list">
        <strong>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ:</strong>
        <span id="favorites-count">0</span> —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        <div id="favorites-list"></div>
      </div>
      <button class="filter-toggle" id="filter-toggle" onclick="toggleFilter()">
        –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
      </button>
    </div>

    <div class="test-section">
      <h2>üè† –¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏</h2>
      <div id="cards-container">
        <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
      </div>
    </div>

    <div class="test-section">
      <h2>üß™ –¢–µ—Å—Ç—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</h2>
      <button class="test-button" onclick="runFilterTests()">
        –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
      </button>
      <button class="test-button" onclick="clearFavorites()">
        –û—á–∏—Å—Ç–∏—Ç—å –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
      </button>
      <button class="test-button" onclick="addTestCards()">
        –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏
      </button>
      <div id="test-results" class="test-results"></div>
    </div>

    <script>
      // –°–∏–º—É–ª—è—Ü–∏—è useFavorites —Å cookies
      class FavoritesManager {
        constructor() {
          this.cookieName = "favorites";
          this.favorites = this.loadFromCookie();
          this.filterEnabled = false;
          this.updateDisplay();
        }

        loadFromCookie() {
          try {
            const cookie = document.cookie
              .split("; ")
              .find((row) => row.startsWith(this.cookieName + "="));
            if (cookie) {
              const value = cookie.split("=")[1];
              return JSON.parse(decodeURIComponent(value));
            }
          } catch (e) {
            console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ cookie:", e);
          }
          return [];
        }

        saveToCookie() {
          try {
            const value = encodeURIComponent(JSON.stringify(this.favorites));
            document.cookie = `${this.cookieName}=${value}; max-age=${
              60 * 60 * 24 * 365
            }; path=/; samesite=lax`;
          } catch (e) {
            console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ cookie:", e);
          }
        }

        toggleFavorite(itemId) {
          const index = this.favorites.indexOf(itemId);
          if (index > -1) {
            this.favorites.splice(index, 1);
            console.log("–£–¥–∞–ª–µ–Ω–æ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ:", itemId);
          } else {
            this.favorites.push(itemId);
            console.log("–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ:", itemId);
          }
          this.saveToCookie();
          this.updateDisplay();
          this.updateCards();
        }

        isFavorite(itemId) {
          return this.favorites.includes(itemId);
        }

        getFavoritesCount() {
          return this.favorites.length;
        }

        clearFavorites() {
          this.favorites = [];
          this.saveToCookie();
          this.updateDisplay();
          this.updateCards();
        }

        updateDisplay() {
          document.getElementById("favorites-count").textContent =
            this.getFavoritesCount();
          const list = document.getElementById("favorites-list");
          list.innerHTML =
            this.favorites.length > 0
              ? this.favorites.map((id) => `<div>‚Ä¢ ${id}</div>`).join("")
              : "<div>–ü—É—Å—Ç–æ</div>";
        }

        updateCards() {
          const cards = document.querySelectorAll(".card");
          cards.forEach((card) => {
            const cardId = card.dataset.cardId;
            const likeButton = card.querySelector(".like-button");
            if (likeButton) {
              const isLiked = this.isFavorite(cardId);
              likeButton.classList.toggle("liked", isLiked);
              card.classList.toggle("favorite", isLiked);

              // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é
              if (this.filterEnabled) {
                card.classList.toggle("filtered-out", !isLiked);
              } else {
                card.classList.remove("filtered-out");
              }
            }
          });
        }

        toggleFilter() {
          this.filterEnabled = !this.filterEnabled;
          const button = document.getElementById("filter-toggle");
          button.textContent = this.filterEnabled
            ? "–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ"
            : "–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ";
          button.classList.toggle("active", this.filterEnabled);
          this.updateCards();

          console.log(
            `–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è ${this.filterEnabled ? "–≤–∫–ª—é—á–µ–Ω–∞" : "–æ—Ç–∫–ª—é—á–µ–Ω–∞"}`
          );
        }
      }

      const favoritesManager = new FavoritesManager();

      function addTestCards() {
        const container = document.getElementById("cards-container");
        container.innerHTML = "";

        const testCards = [
          { id: "order-0", title: "–î–æ–º 1", price: "1000000", area: "120" },
          { id: "order-1", title: "–î–æ–º 2", price: "2000000", area: "150" },
          { id: "order-2", title: "–î–æ–º 3", price: "1500000", area: "100" },
          {
            id: "portfolio-0",
            title: "–ü—Ä–æ–µ–∫—Ç 1",
            price: "3000000",
            area: "200",
          },
          {
            id: "portfolio-1",
            title: "–ü—Ä–æ–µ–∫—Ç 2",
            price: "2500000",
            area: "180",
          },
        ];

        testCards.forEach((card) => {
          const cardElement = document.createElement("div");
          cardElement.className = "card";
          cardElement.dataset.cardId = card.id;
          cardElement.innerHTML = `
                    <div>
                        <strong>${card.title}</strong><br>
                        <span>${card.price} ‚ÇΩ ‚Ä¢ ${card.area} –º¬≤</span>
                    </div>
                    <button class="like-button" onclick="toggleFavorite('${card.id}')">‚ô°</button>
                `;
          container.appendChild(cardElement);
        });

        favoritesManager.updateCards();
      }

      function toggleFavorite(cardId) {
        favoritesManager.toggleFavorite(cardId);
      }

      function clearFavorites() {
        favoritesManager.clearFavorites();
      }

      function toggleFilter() {
        favoritesManager.toggleFilter();
      }

      function runFilterTests() {
        const results = document.getElementById("test-results");
        results.textContent = "–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏...\n";

        // –û—á–∏—â–∞–µ–º –∏–∑–±—Ä–∞–Ω–Ω–æ–µ –¥–ª—è —á–∏—Å—Ç–æ–≥–æ —Ç–µ—Å—Ç–∞
        favoritesManager.clearFavorites();

        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
        favoritesManager.toggleFavorite("order-0");
        favoritesManager.toggleFavorite("order-2");

        // –í–∫–ª—é—á–∞–µ–º —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é
        favoritesManager.toggleFilter();

        setTimeout(() => {
          const visibleCards = document.querySelectorAll(
            ".card:not(.filtered-out)"
          );
          const expectedCount = 2; // order-0 –∏ order-2

          if (visibleCards.length === expectedCount) {
            results.textContent += `‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç! –ü–æ–∫–∞–∑–∞–Ω–æ ${visibleCards.length} –∏–∑ 5 –∫–∞—Ä—Ç–æ—á–µ–∫\n`;
          } else {
            results.textContent += `‚ùå –û—à–∏–±–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏! –ü–æ–∫–∞–∑–∞–Ω–æ ${visibleCards.length}, –æ–∂–∏–¥–∞–ª–æ—Å—å ${expectedCount}\n`;
          }

          // –í—ã–∫–ª—é—á–∞–µ–º —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é
          favoritesManager.toggleFilter();

          setTimeout(() => {
            const allCards = document.querySelectorAll(
              ".card:not(.filtered-out)"
            );
            if (allCards.length === 5) {
              results.textContent += `‚úÖ –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç! –ü–æ–∫–∞–∑–∞–Ω–æ ${allCards.length} –∫–∞—Ä—Ç–æ—á–µ–∫\n`;
            } else {
              results.textContent += `‚ùå –û—à–∏–±–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏! –ü–æ–∫–∞–∑–∞–Ω–æ ${allCards.length}, –æ–∂–∏–¥–∞–ª–æ—Å—å 5\n`;
            }
          }, 100);
        }, 100);
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
      document.addEventListener("DOMContentLoaded", () => {
        const status = document.getElementById("status");
        status.textContent = "‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ";
        status.className = "status success";

        addTestCards();
      });
    </script>
  </body>
</html>
