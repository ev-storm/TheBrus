<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
        background: #1a1a1a;
        color: white;
      }
      .test-section {
        background: #2a2a2a;
        padding: 20px;
        margin: 20px 0;
        border-radius: 8px;
      }
      .status {
        padding: 10px;
        margin: 10px 0;
        border-radius: 4px;
      }
      .success {
        background: #4caf50;
      }
      .error {
        background: #f44336;
      }
      .info {
        background: #2196f3;
      }
      .warning {
        background: #ff9800;
      }
      .test-button {
        background: #65c36c;
        color: white;
        border: none;
        padding: 10px 20px;
        margin: 5px;
        border-radius: 4px;
        cursor: pointer;
      }
      .test-button:hover {
        background: #5ab060;
      }
      .favorites-list {
        background: #333;
        padding: 15px;
        border-radius: 4px;
        margin: 10px 0;
      }
      .card {
        background: #444;
        padding: 15px;
        margin: 10px 0;
        border-radius: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border: 2px solid transparent;
        transition: all 0.3s ease;
      }
      .card.favorite {
        border-color: #65c36c;
        background: #3a4a3a;
      }
      .like-button {
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        font-size: 20px;
        transition: all 0.3s ease;
      }
      .like-button.liked {
        color: #65c36c;
        transform: scale(1.2);
      }
      .like-button:hover {
        color: #65c36c;
      }
      .test-results {
        background: #333;
        padding: 15px;
        border-radius: 4px;
        margin: 10px 0;
        font-family: monospace;
        white-space: pre-wrap;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
      }
    </style>
  </head>
  <body>
    <h1>üéØ –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ</h1>

    <div class="test-section">
      <h2>üìä –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</h2>
      <div id="status" class="status info">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>
      <div class="favorites-list">
        <strong>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ:</strong>
        <span id="favorites-count">0</span> —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        <div id="favorites-list"></div>
      </div>
    </div>

    <div class="grid">
      <div class="test-section">
        <h2>üè† –¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ (–ó–∞–∫–∞–∑)</h2>
        <div id="order-cards">
          <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–∫–∞–∑–∞ -->
        </div>
      </div>

      <div class="test-section">
        <h2>üíº –¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ (–ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ)</h2>
        <div id="portfolio-cards">
          <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ -->
        </div>
      </div>
    </div>

    <div class="test-section">
      <h2>üß™ –¢–µ—Å—Ç—ã —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏</h2>
      <button class="test-button" onclick="runAllTests()">
        –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
      </button>
      <button class="test-button" onclick="clearFavorites()">
        –û—á–∏—Å—Ç–∏—Ç—å –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
      </button>
      <button class="test-button" onclick="addTestData()">
        –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
      </button>
      <button class="test-button" onclick="testCookiePersistence()">
        –¢–µ—Å—Ç cookies
      </button>
      <div id="test-results" class="test-results"></div>
    </div>

    <div class="test-section">
      <h2>üìù –õ–æ–≥–∏</h2>
      <div id="logs" class="test-results"></div>
    </div>

    <script>
      // –°–∏–º—É–ª—è—Ü–∏—è useFavorites —Å cookies
      class FavoritesManager {
        constructor() {
          this.cookieName = "favorites";
          this.favorites = this.loadFromCookie();
          this.logs = [];
          this.updateDisplay();
          this.log("–°–∏—Å—Ç–µ–º–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞");
        }

        log(message) {
          const timestamp = new Date().toLocaleTimeString();
          this.logs.push(`[${timestamp}] ${message}`);
          this.updateLogs();
        }

        updateLogs() {
          const logsElement = document.getElementById("logs");
          logsElement.textContent = this.logs.slice(-10).join("\n");
        }

        loadFromCookie() {
          try {
            const cookie = document.cookie
              .split("; ")
              .find((row) => row.startsWith(this.cookieName + "="));
            if (cookie) {
              const value = cookie.split("=")[1];
              const favorites = JSON.parse(decodeURIComponent(value));
              this.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ –∏–∑ cookies: ${favorites.length} —ç–ª–µ–º–µ–Ω—Ç–æ–≤`);
              return favorites;
            }
          } catch (e) {
            this.log(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ cookie: ${e.message}`);
          }
          this.log("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—É—Å—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ");
          return [];
        }

        saveToCookie() {
          try {
            const value = encodeURIComponent(JSON.stringify(this.favorites));
            document.cookie = `${this.cookieName}=${value}; max-age=${
              60 * 60 * 24 * 365
            }; path=/; samesite=lax`;
            this.log(`–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ cookies: ${this.favorites.length} —ç–ª–µ–º–µ–Ω—Ç–æ–≤`);
          } catch (e) {
            this.log(`–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ cookie: ${e.message}`);
          }
        }

        toggleFavorite(itemId) {
          const index = this.favorites.indexOf(itemId);
          if (index > -1) {
            this.favorites.splice(index, 1);
            this.log(`‚ùå –£–¥–∞–ª–µ–Ω–æ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ: ${itemId}`);
          } else {
            this.favorites.push(itemId);
            this.log(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ: ${itemId}`);
          }
          this.saveToCookie();
          this.updateDisplay();
          this.updateCards();
        }

        isFavorite(itemId) {
          return this.favorites.includes(itemId);
        }

        getFavoritesCount() {
          return this.favorites.length;
        }

        clearFavorites() {
          const count = this.favorites.length;
          this.favorites = [];
          this.saveToCookie();
          this.updateDisplay();
          this.updateCards();
          this.log(`üóëÔ∏è –û—á–∏—â–µ–Ω–æ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ: ${count} —ç–ª–µ–º–µ–Ω—Ç–æ–≤`);
        }

        updateDisplay() {
          document.getElementById("favorites-count").textContent =
            this.getFavoritesCount();
          const list = document.getElementById("favorites-list");
          list.innerHTML =
            this.favorites.length > 0
              ? this.favorites.map((id) => `<div>‚Ä¢ ${id}</div>`).join("")
              : "<div>–ü—É—Å—Ç–æ</div>";
        }

        updateCards() {
          const cards = document.querySelectorAll(".card");
          cards.forEach((card) => {
            const cardId = card.dataset.cardId;
            const likeButton = card.querySelector(".like-button");
            if (likeButton) {
              const isLiked = this.isFavorite(cardId);
              likeButton.classList.toggle("liked", isLiked);
              card.classList.toggle("favorite", isLiked);
            }
          });
        }
      }

      const favoritesManager = new FavoritesManager();

      function addTestData() {
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–∫–∞–∑–∞
        const orderContainer = document.getElementById("order-cards");
        orderContainer.innerHTML = "";

        const orderCards = [
          { id: "order-0", title: "–î–æ–º 1", price: "1000000", area: "120" },
          { id: "order-1", title: "–î–æ–º 2", price: "2000000", area: "150" },
          { id: "order-2", title: "–î–æ–º 3", price: "1500000", area: "100" },
        ];

        orderCards.forEach((card) => {
          const cardElement = createCardElement(card);
          orderContainer.appendChild(cardElement);
        });

        // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ
        const portfolioContainer = document.getElementById("portfolio-cards");
        portfolioContainer.innerHTML = "";

        const portfolioCards = [
          {
            id: "portfolio-0",
            title: "–ü—Ä–æ–µ–∫—Ç 1",
            price: "3000000",
            area: "200",
          },
          {
            id: "portfolio-1",
            title: "–ü—Ä–æ–µ–∫—Ç 2",
            price: "2500000",
            area: "180",
          },
        ];

        portfolioCards.forEach((card) => {
          const cardElement = createCardElement(card);
          portfolioContainer.appendChild(cardElement);
        });

        favoritesManager.updateCards();
        favoritesManager.log("–î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏");
      }

      function createCardElement(card) {
        const cardElement = document.createElement("div");
        cardElement.className = "card";
        cardElement.dataset.cardId = card.id;
        cardElement.innerHTML = `
                <div>
                    <strong>${card.title}</strong><br>
                    <span>${card.price} ‚ÇΩ ‚Ä¢ ${card.area} –º¬≤</span>
                </div>
                <button class="like-button" onclick="toggleFavorite('${card.id}')">‚ô°</button>
            `;
        return cardElement;
      }

      function toggleFavorite(cardId) {
        favoritesManager.toggleFavorite(cardId);
      }

      function clearFavorites() {
        favoritesManager.clearFavorites();
      }

      function testCookiePersistence() {
        const status = document.getElementById("status");
        status.textContent = "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ cookies...";
        status.className = "status info";

        // –î–æ–±–∞–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
        favoritesManager.toggleFavorite("test-persistence");

        setTimeout(() => {
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç —Å–æ—Ö—Ä–∞–Ω–∏–ª—Å—è
          if (favoritesManager.isFavorite("test-persistence")) {
            status.textContent = "‚úÖ Cookies —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!";
            status.className = "status success";
          } else {
            status.textContent = "‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ cookies";
            status.className = "status error";
          }
        }, 100);
      }

      function runAllTests() {
        const results = document.getElementById("test-results");
        results.textContent = "–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤...\n";

        const tests = [
          {
            name: "–¢–µ—Å—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ",
            test: () => {
              favoritesManager.toggleFavorite("test-add");
              return favoritesManager.isFavorite("test-add");
            },
          },
          {
            name: "–¢–µ—Å—Ç —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ",
            test: () => {
              favoritesManager.toggleFavorite("test-add");
              return !favoritesManager.isFavorite("test-add");
            },
          },
          {
            name: "–¢–µ—Å—Ç —Å—á–µ—Ç—á–∏–∫–∞",
            test: () => {
              const initialCount = favoritesManager.getFavoritesCount();
              favoritesManager.toggleFavorite("test-count");
              const newCount = favoritesManager.getFavoritesCount();
              favoritesManager.toggleFavorite("test-count");
              return newCount === initialCount + 1;
            },
          },
          {
            name: "–¢–µ—Å—Ç –æ—á–∏—Å—Ç–∫–∏",
            test: () => {
              favoritesManager.toggleFavorite("test-clear");
              favoritesManager.clearFavorites();
              return favoritesManager.getFavoritesCount() === 0;
            },
          },
        ];

        let passed = 0;
        let total = tests.length;

        tests.forEach((test, index) => {
          try {
            const result = test.test();
            if (result) {
              results.textContent += `‚úÖ ${test.name}\n`;
              passed++;
            } else {
              results.textContent += `‚ùå ${test.name}\n`;
            }
          } catch (e) {
            results.textContent += `‚ùå ${test.name} - –û—à–∏–±–∫–∞: ${e.message}\n`;
          }
        });

        results.textContent += `\n–†–µ–∑—É–ª—å—Ç–∞—Ç: ${passed}/${total} —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ`;

        if (passed === total) {
          results.textContent += "\nüéâ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!";
        } else {
          results.textContent += "\n‚ö†Ô∏è –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ–π–¥–µ–Ω—ã";
        }
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
      document.addEventListener("DOMContentLoaded", () => {
        const status = document.getElementById("status");
        status.textContent = "‚úÖ –°–∏—Å—Ç–µ–º–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ";
        status.className = "status success";

        addTestData();
      });
    </script>
  </body>
</html>
